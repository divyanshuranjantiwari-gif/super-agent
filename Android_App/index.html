<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Agent Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #050505;
            color: #e0e0e0;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        .neon-text {
            text-shadow: 0 0 5px #0ff, 0 0 10px #0ff, 0 0 20px #0ff;
        }

        .neon-box {
            box-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
            border: 1px solid #0ff;
        }

        .btn-ignite {
            background: linear-gradient(45deg, #ff0000, #ff4500);
            box-shadow: 0 0 15px #ff4500;
            transition: all 0.3s ease;
        }

        .btn-ignite:active {
            transform: scale(0.95);
            box-shadow: 0 0 5px #ff4500;
            cursor: pointer;
        }

        .btn-dashboard {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #0ff;
            color: #0ff;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            text-align: center;
        }

        .btn-dashboard:hover {
            background: rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 10px #0ff;
        }

        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(0, 255, 255, 0.3);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }

        @keyframes scan {
            0% {
                top: -10%;
            }

            100% {
                top: 110%;
            }
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center h-screen relative">

    <div class="scan-line"></div>

    <div class="text-center mb-10 z-10">
        <h1 class="text-4xl font-bold neon-text mb-2">SUPER AGENT</h1>
        <p class="text-xs text-cyan-400 tracking-widest">QUANTITATIVE INTELLIGENCE SYSTEM</p>
    </div>

    <!-- Status Display -->
    <div id="status-box"
        class="w-80 min-h-32 bg-black border border-cyan-500 p-4 mb-10 rounded-lg opacity-80 flex flex-col justify-center items-center text-center">
        <p id="status-text" class="text-cyan-300 text-sm">SYSTEM READY</p>
        <div id="loader" class="hidden mt-2 w-full bg-gray-800 h-1 rounded">
            <div class="bg-cyan-500 h-1 rounded animate-pulse" style="width: 100%"></div>
        </div>
        <!-- Dashboard Links Container -->
        <div id="dashboard-links" class="hidden flex-col gap-3 mt-4 w-full">
            <!-- Links injected by JS -->
        </div>
    </div>

    <!-- IGNITE BUTTON -->
    <button id="ignite-btn" onclick="igniteAgent()"
        class="btn-ignite w-48 h-48 rounded-full flex flex-col items-center justify-center z-10 border-4 border-red-900">
        <span class="text-3xl font-bold text-white tracking-wider">IGNITE</span>
        <span class="text-[10px] text-red-200 mt-1">RUN ANALYSIS</span>
    </button>

    <!-- Config (Hidden by default, user needs to edit code or input once) -->
    <div class="absolute bottom-5 text-xs text-gray-600">
        v2.1.0 | DUAL DASHBOARD
    </div>

    <script>
        // CONFIGURATION - USER MUST FILL THIS
        const GITHUB_USER = "divyanshuranjantiwari-gif";
        const GITHUB_REPO = "super-agent";
        const GITHUB_TOKEN = "YOUR_GITHUB_TOKEN_HERE"; // Needs 'repo' scope

        async function igniteAgent() {
            const statusText = document.getElementById('status-text');
            const loader = document.getElementById('loader');
            const linksDiv = document.getElementById('dashboard-links');
            const igniteBtn = document.getElementById('ignite-btn');

            if (GITHUB_USER === "YOUR_GITHUB_USERNAME") {
                alert("Please configure your GitHub details in the index.html file!");
                return;
            }

            // Reset UI
            linksDiv.innerHTML = "";
            linksDiv.classList.add("hidden");
            statusText.innerText = "INITIATING UPLINK...";
            statusText.classList.add("animate-pulse");
            statusText.classList.remove("text-red-500");
            loader.classList.remove("hidden");
            igniteBtn.disabled = true;
            igniteBtn.style.opacity = "0.7";

            try {
                // 1. Trigger the Workflow
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        event_type: 'run_analysis'
                    })
                });

                if (!response.ok) throw new Error("Failed to trigger analysis");

                statusText.innerText = "COMMAND SENT. WAITING FOR GITHUB...";

                // 2. Wait for run to be created (5 seconds)
                await new Promise(r => setTimeout(r, 5000));

                // 3. Start Polling Loop
                const pollInterval = setInterval(async () => {
                    try {
                        const runsResponse = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/actions/runs?event=repository_dispatch&per_page=1`, {
                            headers: {
                                'Authorization': `token ${GITHUB_TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });

                        const runsData = await runsResponse.json();
                        const latestRun = runsData.workflow_runs[0];

                        if (!latestRun) {
                            statusText.innerText = "WAITING FOR RUN TO START...";
                            return;
                        }

                        // Update Status Text
                        if (latestRun.status === 'completed') {
                            clearInterval(pollInterval);
                            loader.classList.add("hidden");
                            statusText.classList.remove("animate-pulse");
                            igniteBtn.disabled = false;
                            igniteBtn.style.opacity = "1";

                            if (latestRun.conclusion === 'success') {
                                statusText.innerText = "ANALYSIS COMPLETE";
                                linksDiv.classList.remove("hidden");
                                linksDiv.innerHTML = `
                                    <a href="https://${GITHUB_USER}.github.io/${GITHUB_REPO}/super_agent_swing.html" target="_blank" class="btn-dashboard">SWING DASHBOARD</a>
                                    <a href="https://${GITHUB_USER}.github.io/${GITHUB_REPO}/super_agent_intraday.html" target="_blank" class="btn-dashboard">INTRADAY DASHBOARD</a>
                                `;
                            } else {
                                statusText.innerText = "ANALYSIS FAILED (Check GitHub)";
                                statusText.classList.add("text-red-500");
                            }
                        } else {
                            // Still running
                            statusText.innerText = `STATUS: ${latestRun.status.toUpperCase()}...`;
                        }
                    } catch (err) {
                        console.error("Polling Error:", err);
                    }
                }, 5000); // Check every 5 seconds

            } catch (error) {
                console.error(error);
                statusText.innerText = "CONNECTION FAILED";
                statusText.classList.remove("animate-pulse");
                loader.classList.add("hidden");
                igniteBtn.disabled = false;
                igniteBtn.style.opacity = "1";
            }
        }
    </script>
</body>

</html>